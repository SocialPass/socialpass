# Use a Python 3.11 base image from the bullseye tag.
FROM python:3.11

# Set the working directory to /app/.
WORKDIR /app/

# ENVs
ENV DJANGO_SETTINGS_MODULE=$DJANGO_SETTINGS_MODULE

# Copy the Python requirements files to the container.
COPY /backend/config/requirements/production.txt /app/production.txt
COPY /backend/config/requirements/base.txt /app/base.txt

# Copy your entire codebase, including the Django project, to the container.
COPY /backend /app/

# Update pip and install Python dependencies.
RUN pip install --upgrade pip
RUN pip install -r production.txt

# Run Django migrations and collectstatic.
RUN python manage.py migrate
RUN python manage.py collectstatic --no-input

# Specify how to run your Django application using Gunicorn.
CMD ["gunicorn", "config.wsgi:application", "--worker-tmp-dir", "/dev/shm"]
