<!-- EDITED FROM AUTO GENERATED CODE -->

<style>
    .sb-title {
        position: relative;
        top: -12px;
        font-family: Roboto, sans-serif;
        font-weight: 500;
    }

    .sb-title-icon {
        position: relative;
        top: -5px;
    }

    .card-container {
        display: flex;
        gap: 10px;
        flex-direction: column;
        width: 100%;
    }

    .panel {
        background: white;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        gap: 10px;
    }

    .half-input-container {
        display: flex;
        justify-content: space-between;
        flex-flow: row wrap;
        gap: 10px 10px;
    }

    .half-input {
        flex-grow: 10;
    }

    .map {
        height: 170px;
    }

    .gmap-input {
        height: 30px;
    }

    .gmap-input {
        border: 0;
        border-bottom: 1px solid;
        border-color: var(--input-border-color);
        font-size: 14px;
        font-family: Roboto, sans-serif;
        font-style: normal;
        font-weight: normal;
    }

    .gmap-input:focus::placeholder {
        color: white;
    }
</style>
<script>
    "use strict";

    const addressNameFormat = {
        'street_number': 'short_name',
        'route': 'long_name',
        'locality': 'long_name',
        'administrative_area_level_1': 'short_name',
        'country': 'long_name',
        'postal_code': 'short_name',
    };

    const getAddressComp = function (place, type) {
        for (const component of place.address_components) {
            if (component.types[0] === type) {
                return component[addressNameFormat[type]];
            }
        }
        return '';
    };

    const getGmapsFormInputElement = (component) => document.getElementById(component + '-input');


    function initMap() {
        const CONFIGURATION = {
            "ctaTitle": "Confirm",
            "mapOptions": {"center":{"lat":37.4221,"lng":-122.0841},"fullscreenControl":true,"mapTypeControl":false,"streetViewControl":false,"zoom":11,"zoomControl":true,"maxZoom":22},
            "mapsApiKey": "AIzaSyDvnSgXjZveWOkuDv4FuXlQ54dlJUgAn8c",
            "capabilities": {"addressAutocompleteControl":true,"mapDisplayControl":true,"ctaControl":false}
        };
        const componentForm = [
            'location',
            'locality',
            'administrative_area_level_1',
            'country',
            'postal_code',
        ];

        const map = new google.maps.Map(document.getElementById("gmp-map"), {
            zoom: CONFIGURATION.mapOptions.zoom,
            center: { lat: 37.4221, lng: -122.0841 },
            mapTypeControl: false,
            fullscreenControl: CONFIGURATION.mapOptions.fullscreenControl,
            zoomControl: CONFIGURATION.mapOptions.zoomControl,
            streetViewControl: CONFIGURATION.mapOptions.streetViewControl
        });
        const marker = new google.maps.Marker({map: map, draggable: false});
        const autocompleteInput = getGmapsFormInputElement('location');
        const autocomplete = new google.maps.places.Autocomplete(autocompleteInput, {
            fields: ["address_components", "geometry", "name", "utc_offset_minutes"],
            types: ["address"],
        });
        function handlePlaceChange(place){
            marker.setVisible(false);
            if (!place){
                place = autocomplete.getPlace();
            }

            if (!place.geometry) {
                // User entered the name of a Place that was not suggested and
                // pressed the Enter key, or the Place Details request failed.
                window.alert('No details available for input: \'' + place.name + '\'');
                return;
            }
            renderAddress(place);
            fillInAddress(place);

            let placeChangedExternalCallback = window["{{placeChangedCallback}}"]
            if (placeChangedExternalCallback) {
                placeChangedExternalCallback(place);
            }
        }
        autocomplete.addListener('place_changed', handlePlaceChange);

        function fillInAddress(place) {  // optional parameter
            getGmapsFormInputElement('location').value = getAddressComp(place, 'street_number') + ' '
                    + getAddressComp(place, 'route');
            for (const component of componentForm) {
                // Location field is handled separately above as it has different logic.
                if (component !== 'location') {
                    getGmapsFormInputElement(component).value = getAddressComp(place, component);
                }
            }
        }

        function renderAddress(place) {
            map.setCenter(place.geometry.location);
            marker.setPosition(place.geometry.location);
            marker.setVisible(true);
        }


        // Set from initial data
        let initialPlaceValue = "{{initialPlace}}"
        if (initialPlaceValue){
            let autocompleteService = new google.maps.places.AutocompleteService();
            let request = {input: initialPlaceValue};
            autocompleteService.getPlacePredictions(request, (predictionsArr, placesServiceStatus) => {
                let placeRequest = {placeId: predictionsArr[0].place_id};
                let placeService = new google.maps.places.PlacesService(document.createElement('div'));
                placeService.getDetails(placeRequest, (placeResult, placeServiceStatus) => {
                    handlePlaceChange(placeResult);
                });
            });
        }

    }
</script>
<div id="gmap-container" class="card-container">
    <div class="panel">
        <input class="gmap-input" type="text" placeholder="Address*" id="location-input"/>
        <div class="half-input-container">
            <input class="gmap-input half-input" type="text" placeholder="Apt, Suite, etc (optional)"/>
            <input class="gmap-input half-input" type="text" placeholder="City" id="locality-input"/>
        </div>
        <div class="half-input-container">
            <input class="gmap-input half-input" type="text" placeholder="State/Province" id="administrative_area_level_1-input"/>
            <input class="gmap-input half-input" type="text" placeholder="Zip/Postal code" id="postal_code-input"/>
            <input class="gmap-input half-input" type="text" placeholder="Country" id="country-input"/>
        </div>
    </div>
    <div class="map" id="gmp-map"></div>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key={{GMAPS_API_KEY}}&libraries=places&callback=initMap&solution_channel=GMP_QB_addressselection_v1_cAB" async defer></script>
