{% extends 'bases/base_primary.html' %}
{% load static i18n get_chain_name crispy_forms_tags avoid_view_resubmission %}

{% block head_title %}Events - SocialPass{% endblock head_title %}
{% block navbar_breadcrumb %}{% if url_name == 'ticketgate_create' %}Create{% else %}Update{% endif %} Event{% endblock %}

{% block content %}
<script src="{% static 'js/main.js' %}"></script>
<script>

  window.onload = () => {
    let first_error = document.getElementsByClassName('invalid-feedback')[0]
    if (first_error){
      first_error.scrollIntoView({behavior: "smooth", block: "center", inline: "center"});
    }
  }

  function saveAsDraft(){
    document.getElementById("id_is_draft").checked = true
    document.getElementById("id_is_draft").value = 'True'
    document.getElementById("create-event-form").submit()
  }

  function stageEvent(){
    document.getElementById("id_is_draft").checked = false
    document.getElementById("id_is_draft").value = 'False'
    document.getElementById("create-event-form").submit()
  }

  function save(){
    document.getElementById("create-event-form").submit()
  }

  function unpublish(){
    document.getElementById("create-event-form").submit()
  }

  function displayPublishModal(){

  }

</script>

<div class="row event-form">
  <div class="col col-12 col-sm-4">
    <div class="navigation-container py-30 px-10">
      {% if url_name == 'ticketgate_create' %}Create{% else %}Update{% endif %} Event ({{event.status}})
      <ol>
        <li>
          <a href="#1-general-info">General Info</a>
          <ul>
            <li><a href="#1-1-basic-info">Basic Info</a></li>
            <li><a href="#1-2-location">Location</a></li>
            <li><a href="#1-3-date-and-time">Date and Time</a></li>
            <li><a href="#1-4-main-event-image">Cover Image</a></li>
          </ul>
        </li>
        <li>
          <a href="#2-blockchain-requirements">Blockchain Requirements</a>
        </li>
        <li>
          <a href="#3-tickets">Tickets Selection</a>
        </li>
        <li>
          <a href="#4-publish" disabled>Publish</a>
        </li>
      </ol>
      <div id="event-form-toolbar">
        <a href="#checkout_portal_preview_url">Preview Event</a>
        <br/>
        {% if event.status == "Draft" %}
          <button onclick="saveAsDraft()">Save Draft</button>
          <button onclick="stageEvent()">Stage Event</button>
        {% elif event.status == "Staged" %}
          <button onclick="saveAsDraft()">Save as Draft</button>
          <button onclick="displayPublishModal()">Preview and Publish</button>
        {% elif event.status == "Scheduled" %}
          <button onclick="save()">Save</button>
          <form action="{% url 'ticketgate_update' view.kwargs.team_pk event.pk %}?action=unpublish" method="POST">
            {% csrf_token %}
            <input type="submit" value="Unschedule"/>
          </form>
        {% elif event.status == "Published" %}
          <button onclick="save()">Save</button>
          <form action="{% url 'ticketgate_update' view.kwargs.team_pk event.pk %}?action=unpublish" method="POST">
            {% csrf_token %}
            <input type="submit" value="Unpublish"/>
          </form>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col col-12 col-sm-8 py-30 px-10">
    <!--
    In case we want to show a summary of errors:
    {% if form.errors %}
      {% for field in form %}
        {% if field.errors %}
          field: {{field.name}}
          {% for error in field.errors %}
            {{ error|escape }}
          {% endfor %}
        {% endif %}
      {% endfor %}
    {% endif %}
    -->
    <form id="create-event-form" class="form" method="post">
      {% csrf_token %}
      {{ form.is_draft }}
      <section id="1-general-info">
        <div class="row">
          <span style="line-height: 40px; height: 40px; width: 40px; text-align: center"
                class="col-1 rounded-circle bg-primary text-on-primary content-title m-0 fs-base-p6 ml-1">
            1
          </span>
          <h1 style="line-height: 40px" class="col content-title m-0 fs-base-p6">General Info</h1>
        </div>
        <p class="text-muted mt-0 mb-0 fs-base-n2">Please fill in some general information about your event.</p>
        <hr/>
        <section id="1-1-basic-info">
          <div class="row">
            <div class="col col-2">
              image
            </div>
            <div class="col">
              <h2 class="card-title fs-base-p4 mb-0">Basic Info</h2>
              <p class="text-muted mt-0 mb-0 fs-base-n2">Name your event and tell event-goers why they should come.
                Add details that highlight what makes it unique</p>
            </div>
          </div>
          <div>
            <div class="form-group col-md-6 mb-10">
              {{form.title|as_crispy_field}}
            </div>
            <div class="form-group col-md-6 mb-10">
              {{form.organizer|as_crispy_field}}
            </div>
            <div class="form-group col-md-6 mb-10">
              {{form.description|as_crispy_field}}
            </div>
            <div class="form-group col-md-6 mb-10">
              {{form.visibility|as_crispy_field}}
            </div>
          </div>
        </section>
        <hr/>
        <section id="1-2-location">
          <div class="row">
            <div class="col col-2">
              image
            </div>
            <div class="col">
              <h2 class="card-title fs-base-p4 mb-0">Location</h2>
              <p class="text-muted mt-0 mb-0 fs-base-n2">Help people in the area discover your event and let
                attendees know where to show up.</p>
            </div>
            <div>
              {{form.location|as_crispy_field}}
            </div>
          </div>
          <div>
              forms
          </div>
        </section>
        <hr/>
        <section id="1-3-date-and-time">
          <div class="row">
            <div class="col col-2">
              image
            </div>
            <div class="col">
              <h2 class="card-title fs-base-p4 mb-0">Date and Time</h2>
              <p class="text-muted mt-0 mb-0 fs-base-n2">Tell event-goers when your event starts and ends so
                they can make plans to attend.</p>
            </div>
          </div>
          <div>
            <div class="form-group col-md-6 mb-10">
              {{form.start_date|as_crispy_field}}
            </div>
            <div class="form-group col-md-6 mb-10">
              {{form.end_date|as_crispy_field}}
            </div>
            <div class="form-group col-md-6 mb-10">
              {{form.timezone|as_crispy_field}}
            </div>
        </section>
        <hr/>
        <section id="1-4-main-event-image">
          <div class="row">
            <div class="col col-2">
              image
            </div>
            <div class="col">
              <h2 class="card-title fs-base-p4 mb-0">Main Event Image</h2>
              <p class="text-muted mt-0 mb-0 fs-base-n2">Use this image to showcase your event. This will be the
                banner image attendees will se when purchasing the tickets.</p>
            </div>
          </div>
          <div class="form-group col-md-6 mb-10">
            {{form.cover_image|as_crispy_field}}
          </div>
        </section>
      </section>
      <hr/>
      <section id="2-blockchain-requirements">
        <div class="row">
          <span style="line-height: 40px; height: 40px; width: 40px; text-align: center"
                class="col-1 rounded-circle bg-primary text-on-primary content-title m-0 fs-base-p6 ml-1">
            2
          </span>
          <h1 style="line-height: 40px" class="col content-title m-0 fs-base-p6">Blockchain Requirements</h1>
        </div>
        <p class="text-muted mt-0 mb-0 fs-base-n2">Please provide the NFT or SocialToken information required to redeeem or purchase a ticket to your event.</p>
        <hr/>
        {{form.requirements|as_crispy_field}}
      </section>
      <hr/>
      <section id="3-tickets">
        <div class="row">
          <span style="line-height: 40px; height: 40px; width: 40px; text-align: center"
                class="col-1 rounded-circle bg-primary text-on-primary content-title m-0 fs-base-p6 ml-1">
            3
          </span>
          <h1 style="line-height: 40px" class="col content-title m-0 fs-base-p6">Ticket Selections</h1>
        </div>
        <p class="text-muted mt-0 mb-0 fs-base-n2">Coming soon! Sell different tickets for an event.</p>
        {{form.capacity|as_crispy_field}}
        {{form.limit_per_person|as_crispy_field}}
      </section>
      <hr/>
      <section id="4-publish">
        <div class="row">
          <span style="line-height: 40px; height: 40px; width: 40px; text-align: center"
                class="col-1 rounded-circle bg-primary text-on-primary content-title m-0 fs-base-p6 ml-1">
            4
          </span>
          <h1 style="line-height: 40px" class="col content-title m-0 fs-base-p6">Publish</h1>
        </div>
        <p class="text-muted mt-0 mb-0 fs-base-n2">Make your event publicly available</p>
        {{form.publish_date|as_crispy_field}}
        {{form.custom_url_path|as_crispy_field}}
      </section>
    </form>
  </div>
</div>
{% endblock %}
