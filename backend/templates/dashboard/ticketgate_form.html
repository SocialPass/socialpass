{% extends 'dashboard/base.html' %}
{% load static i18n get_chain_name crispy_forms_tags %}

{% block title %}Ticket Gate Form - SocialPass {% endblock %}

{% block navbar_page_name_1 %}Ticket Gate {% if url_name == 'ticketgate_create' %}Create{% else %}Update{% endif %}{% endblock %}
{% block navbar_page_name_2 %}Ticket Gate {% if url_name == 'ticketgate_create' %}Create{% else %}Update{% endif %}{% endblock %}

{% block content %}
<script src="{% static 'js/json-editor.min.js' %}"></script>
<div class="row">
	<div class="col-sm-10 col-md-12 mx-auto">
		<div class="card mb-4">
			<div class="card-header py-0">
				<div class="d-flex align-items-center py-3">
					{% if url_name == 'ticketgate_create'  %}
					<div class="pe-2">
						<h6 class="m-0">Ticket Gate Create</h6>
						<div class="text-muted text-xs mb-3">
							Use the following form to create an ticket gate.
						</div>
					</div>
					{% else %}
					<div class="pe-2">
						<h6 class="m-0">Ticket Gate Update</h6>
						<div class="text-muted text-xs mb-3">
							Use the following form to update the ticket gate.
						</div>
					</div>
					{% endif %}
					<a href="{% url 'ticketgate_list' view.kwargs.team_pk %}" class="btn bg-gradient-secondary btn-sm ms-auto my-0">
						<i class="fa-solid fa-angle-left"></i>
						Back
					</a>
				</div>
			</div>
			<div class="card-body py-2">
				<form class="form" method="post">
					{% csrf_token %}
					{{ form|crispy }}
          <div id="editor_holder"></div>
					<div class="text-end my-3">
						<input type="submit" id="submit" value="Submit" class="btn bg-gradient-primary btn-sm ms-auto my-0">
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script>
  // Initialize the editor with a JSON schema
  var _schema = '{{json_schema|safe}}';
  var json_data = "{{object.requirements|safe}}";
  var editor = new JSONEditor(document.getElementById('editor_holder'),{
    schema: JSON.parse(_schema),
    theme: 'spectre',
    iconlib: 'fontawesome5',
    startval: json_data ? JSON.parse(json_data.replace(/'/g, '"')) : null,
    // UI
    array_controls_top: true,
    disable_collapse: true,
    disable_array_delete_all_rows: true,
    disable_array_delete_last_row: true,
    disable_array_reorder: true,
    disable_edit_json: true,
    disable_properties: true,
    keep_oneof_values: false,
    prompt_before_delete: false,
    remove_button_labels: true,
    show_opt_in: false,
  });

  editor.on('change',() => {
     document.getElementById("id_requirements").value = JSON.stringify(editor.getValue());
  });
</script>
{% endblock %}
