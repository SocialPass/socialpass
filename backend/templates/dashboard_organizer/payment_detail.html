{% extends "bases/base_primary.html" %}
{% load static get_theme_value get_user_primary_email %}

{% block head_title %}Payment Details - {% get_theme_value "brand_name" %}{% endblock head_title %}

{% block navbar_breadcrumb %}Payment Details{% endblock %}

{% block content %}
<!-- Header start -->
<div class="border-bottom hs-md-100">
	<div class="p-content d-flex h-100">
		<div class="pe-15 align-self-center">
			<h1 class="content-title m-0 fs-base-p6">Payment Details</h1>
			<p class="text-muted mt-5 mt-5 mb-0 fs-base-n2">
				Connect and manage your team's <strong>Stripe</strong> account.
			</p>
		</div>
		<div class="ms-auto align-self-center">
			<a href="#" class="btn btn-danger">
				<i class="fa-solid fa-times"></i>
				<span class="ms-5 d-none d-sm-inline">Remove</span>
			</a>
		</div>
	</div>
</div>
<!-- Header end -->

<!-- Content card start -->
<div class="card rounded-0 border-top-transparent border-start-0 border-end-0 p-0 m-0">
	<!-- Card header start -->
	<div class="px-card py-10 border-bottom">
		<span class="d-inline-block bg-primary-very-light-lm bg-primary-very-dim-dm border-start border-primary border-2 px-10 py-5 fs-base-n2 fw-bold">
			Payment Details
		</span>
	</div>
	<!-- Card header end -->

	<div class="row">
		<!-- Main content start -->
		<div class="col-lg-6 border-lg-end">
			<div class="content">
				<p class="fs-base-n2">
					You're managing payment details as...<br />
					<strong>{{ request.user.username }}</strong> - <a href="mailto:{% get_user_primary_email %}" target="_blank" class="fw-bold">{% get_user_primary_email %}</a>
				</p>
				{% if current_team.is_stripe_connected %}
					<h2 class="card-title fs-base-p4 mt-20 mb-0">
						<i class="fa-regular fa-check-circle text-success me-5"></i>
						Stripe Account Connected
					</h2>
					<p class="fs-base-n2 mt-5">
						The following Stripe account is connected to your team. You can now start creating fiat tiers and accept payments!
					</p>
					<div class="form-group">
						<label class="form-label">Account ID</label>
						<input class="form-control" value="{{ current_team.stripe_account_id }}" readonly>
					</div>
					<div class="form-group">
						<label class="form-label">Country</label>
						<input class="form-control" value="{{ current_team.stripe_account_country }}" readonly>
					</div>
					<hr />
					<p class="fs-base-n2 mt-5">
						If you want to change your payment details, please remove this account first and connect another one.
					</p>
				{% else %}
					<h2 class="card-title fs-base-p4 mt-20 mb-0">Connect Stripe Account</h2>
					<p class="fs-base-n2 mt-5">
						Before you can create fiat tiers and start accepting payments, you must connect your Stripe account. Click on the following button to get started. You will be redirected to a form which you will need to fill up with your account information.
					</p>
					<form class="form" method="post">
						{% csrf_token %}
						{{ form }}
						<div class="form-group">
							<button
								type="submit"
								class="btn btn-primary btn-lg fs-base btn-block"
								style="
									--button-primary-bg-color: #5433ff;
									--button-primary-bg-color-hover: #5433ff;
									--button-primary-bg-color-active: #5433ff;
									--button-primary-text-color: #fff;
									--button-primary-text-color-hover: #fff;
									--button-primary-text-color-active: #fff;
								"
								onclick="post(event)"
							>
								<i class="fa-brands fa-stripe-s me-5"></i>
								Connect Stripe Account
							</button>
						</div>
					</form>
				{% endif %}
			</div>
		</div>
		<!-- Main content end -->

		<!-- Illustration start -->
		<div class="col-lg-6 d-none d-lg-flex align-items-center justify-content-center ">
			<div class="content w-100">
				<img src="{% static 'images/illustrations/payment.svg' %}" class="d-block w-100" alt="payment">
			</div>
		</div>
		<!-- Illustration end -->
	</div>

	<!-- Card footer start -->
	<div class="px-card py-10 border-top text-muted fs-base-n2">
		Please <a href="#" data-hm-toggle="modal" data-hm-target="discord-support-ticket-modal" target="_blank" class="fw-bold antialiased">contact us</a> and let us know if you need help managing your payment details.
	</div>
	<!-- Card footer end -->
</div>
<!-- Content card end -->
{% endblock content %}

{% block extra_body %}
	<!-- Connect Stripe button processing state -->
	<script type="text/javascript">
		function post(event) {
			event.target.classList.add("disabled");
			event.target.innerHTML = [
		        `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>`,
		        `<span class="ms-5">Processing...</span>`,
		    ].join("");
		}
	</script>
{% endblock %}
