{% extends "redesign/checkout/base.html" %}
{% load static i18n get_theme_value %}

{% block head_title %}{{ event.title }} - SocialPass{% endblock head_title %}

{% block content %}
<div class="card border-0 rounded-4 shadow-sm overflow-hidden my-3 my-sm-4">
	<!-- Cover image start -->
	<div class="position-relative overflow-hidden d-flex align-items-center justify-content-center h-auto">
		<img src="{{ event.cover_image_url }}" alt="{{ event.title }} background image" class="position-absolute top-50 start-50 translate-middle opacity-50" style="width: 200%; height: auto; filter: blur(1.5rem);">
		<img src="{{ event.cover_image_url }}" class="img-fluid position-relative z-1" alt="{{ event.title }} cover image">
	</div>
	<!-- Cover image start -->

	<!-- Team image and name start -->
	<div class="position-relative z-1" style="margin-top: -37px;">
		<div class="specific-w-75 specific-h-75 rounded-circle border border-5 d-flex align-items-center justify-content-center overflow-hidden mx-auto" style="border-color: var(--bs-content-bg) !important;">
			{% if event.team.image %}
				<img src="{{ event.team.image.url }}" class="d-block w-100 h-auto" alt="Team image">
			{% else %}
				<div class="rounded-circle d-flex align-items-center justify-content-center bg-secondary-subtle flex-shrink-0" style="width: 125%; height: 125%;">
					<span class="text-uppercase fs-3 m-0 lh-1 fw-bold">{{ event.team.name|slice:"0:1" }}</span>
				</div>
			{% endif %}
		</div>
		<h6 class="mt-1 mb-0 text-center">
			<span class="fw-normal">{% trans "Hosted By" %}</span>
			<span class="text-primary-emphasis">{{ event.team.name }}</span>
			{% if event.team.is_verified %}
				<i class="fa-solid fa-badge-check text-primary ms-1"></i>
			{% endif %}
		</h6>
	</div>
	<!-- Team image and name end -->

	<!-- Event name, description, dates, location start -->
	<div class="p-3 p-sm-4 mt-3">
		<div class="container-fluid overflow-hidden">
			<div class="row g-3">
				<div class="col-lg-6">
					<h1 class="text-body-emphasis display-6 m-0 text-break">
						{{ event.title }}
					</h1>
					<div id="desc-cont" class="my-3 overflow-hidden position-relative max-h-200">
						{{ event.description_html | safe }}
						<div id="desc-read" class="d-none position-absolute bottom-0 start-0 w-100 text-center pb-1">
							<button
								type="button"
								class="btn btn-link"
								onclick="(function(){
									document.getElementById('desc-cont').classList.remove('overflow-hidden');
									document.getElementById('desc-cont').classList.remove('max-h-200');
									document.getElementById('desc-read').classList.add('d-none');
									return false;
								})();return false;"
							>
								{% trans "Read More" %}
							</button>
						</div>
					</div>
				</div>
				<div class="col-lg-6 ps-lg-4">
					<div class="container-fluid overflow-hidden g-0">
						<div class="row g-3">
							<div class="col-sm-6">
								<div class="d-flex align-items-center">
									<div class="specific-w-25 specific-h-25 flex-shrink-0 d-flex align-items-center justify-content-center bg-primary-subtle rounded">
										<i class="fa-solid fa-calendars fs-6 text-primary-emphasis"></i>
									</div>
									<strong class="text-primary-emphasis ms-3">{% trans "Date & Time" %}</strong>
								</div>
								<div class="mt-2">
									<span class="text-body-secondary">
										<strong class="text-body">{% trans "Start" %}:</strong>
										{% if event.start_date %}
											{{ event.start_date }}
										{% else %}
											{% trans "Not set" %}
										{% endif %}
									</span>
									{% if event.end_date %}
										<br />
										<span class="text-body-secondary"><strong class="text-body">{% trans "End" %}:</strong> {{ event.end_date }}</span>
									{% endif %}
									<br />
									<span class="text-body-secondary">
										<strong class="text-body">{% trans "Timezone" %}:</strong>
										{% if event.timezone %}
											{{ event.timezone }}
										{% else %}
											{% trans "Not set" %}
										{% endif %}
									</span>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="d-flex align-items-center">
									<div class="specific-w-25 specific-h-25 flex-shrink-0 d-flex align-items-center justify-content-center bg-primary-subtle rounded">
										<i class="fa-solid fa-location-dot fs-6 text-primary-emphasis"></i>
									</div>
									<strong class="text-primary-emphasis ms-3">{% trans "Location" %}</strong>
								</div>
								<div class="mt-2">
									<span class="text-body-secondary">{{ event.localized_address_display }}</span>
								</div>
							</div>
						</div>
					</div>
					<div class="mt-3">
						{% if sales_status == "OPEN" %}
							<div class="alert alert-primary text-primary-emphasis d-flex align-items-center fw-bold">
								<i class="fa-light fa-check me-3"></i>
								{% trans "Tickets available! Please select the tickets you want to purchase." %}
							</div>
						{% elif sales_status == "UPCOMING" %}
							<div class="alert alert-warning text-warning-emphasis d-flex align-items-center fw-bold">
								<i class="fa-light fa-times me-3"></i>
								{% trans "Stay tuned! Tickets are going live soon. See the timer below." %}
							</div>
						{% elif sales_status == "OVER" %}
							<div class="alert alert-danger text-warning-danger d-flex align-items-center fw-bold">
								<i class="fa-light fa-times me-3"></i>
								{% trans "Sorry! Tickets are not available for this event." %}
							</div>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Event name, description, dates, location end -->
</div>

<!-- Countdown timer start -->
{% if sales_status == "UPCOMING" %}
	<div class="card border-0 rounded-4 shadow-sm overflow-hidden my-3 my-sm-4">
		<div class="p-3 p-sm-4">
			<div class="container-fluid overflow-hidden">
				<div class="row g-3 g-sm-4 align-items-center">
					<div class="col-lg-4">
						<div class="d-flex align-items-center">
							<div class="specific-w-25 specific-h-25 flex-shrink-0 d-flex align-items-center justify-content-center bg-primary-subtle rounded">
								<i class="fa-solid fa-clock fs-6 text-primary-emphasis"></i>
							</div>
							<strong class="text-primary-emphasis ms-3">{% trans "Ticket Sales Start" %}</strong>
						</div>
						<div class="mt-2">
							<span class="text-body-secondary">{{ event.sales_start }} {{ event.timezone }}</span>
						</div>
					</div>
					<div class="col-lg-8">
						<div class="container-fluid overflow-hidden g-0">
							<div class="row g-3">
								<div class="col-6 col-sm-3 text-center">
									<div class="h3 lh-1 text-primary-emphasis m-0 rounded bg-primary-subtle px-3 py-2" id="days">...</div>{% trans "days" %}
								</div>
							    <div class="col-6 col-sm-3 text-center">
									<div class="h3 lh-1 text-primary-emphasis m-0 rounded bg-primary-subtle px-3 py-2" id="hours">...</div>{% trans "hours" %}
								</div>
							    <div class="col-6 col-sm-3 text-center">
									<div class="h3 lh-1 text-primary-emphasis m-0 rounded bg-primary-subtle px-3 py-2" id="mins">...</div>{% trans "minutes" %}
								</div>
							    <div class="col-6 col-sm-3 text-center">
									<div class="h3 lh-1 text-primary-emphasis m-0 rounded bg-primary-subtle px-3 py-2" id="secs">...</div>{% trans "seconds" %}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endif %}
<!-- Countdown timer end -->
{% endblock %}

{% block extra_body %}
<script type="text/javascript">
	if (document.getElementById("desc-cont").scrollHeight > document.getElementById("desc-cont").clientHeight) {
		document.getElementById("desc-read").classList.remove("d-none");
	}
</script>
{% if sales_status == "UPCOMING" %}
	<script>
		// The data/time we want to countdown to
	    var countDownDate = new Date("{{ sales_start_with_tzinfo.isoformat }}").getTime();

		// Run countdownIntervalFunc every second
	    var countdownIntervalFunc = setInterval(function() {
			var now = new Date().getTime();
	    	var timeleft = countDownDate - now;

		    // Calculating the days, hours, minutes and seconds left
		    var days = Math.floor(timeleft / (1000 * 60 * 60 * 24));
		    var hours = Math.floor((timeleft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
		    var minutes = Math.floor((timeleft % (1000 * 60 * 60)) / (1000 * 60));
		    var seconds = Math.floor((timeleft % (1000 * 60)) / 1000);

		    // Result is output to the specific element
		   	document.getElementById("days").innerHTML = `${days}`;
			document.getElementById("hours").innerHTML = `${hours}`;
			document.getElementById("mins").innerHTML = `${minutes}`;
			document.getElementById("secs").innerHTML = `${seconds}`;

		    // Countdown is over
		    if (timeleft < 0) {
		    	// Clear interval
		        clearInterval(countdownIntervalFunc);

		        // Reset UI
				// TODO: Hide countdown timer, play confetti, refresh page
			    document.getElementById("days").innerHTML = "";
			    document.getElementById("hours").innerHTML = "";
			    document.getElementById("mins").innerHTML = "";
			    document.getElementById("secs").innerHTML = "";
			}
	    }, 1000);
	</script>
{% endif %}
{% endblock %}